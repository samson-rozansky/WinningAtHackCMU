<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Market Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        form { margin-bottom: 20px; }
        input, select { padding: 5px; margin-top: 5px; }
        .notifications { color: red; }
    </style>
</head>
<body>
    <h1>Welcome, {{ user_name }}!</h1>
    <div class="notifications" id="notifications"></div>

    <h2>Submit as Buyer or Seller</h2>
    <form action="/submit" method="post">
        <select name="role" required>
            <option value="">Select Role</option>
            <option value="buyer">Buyer</option>
            <option value="seller">Seller</option>
        </select>

        <input type="number" name="price" placeholder="Price" required>

        <select name="payment" required>
            <option value="">Select Payment</option>
            <option value="zelle">Zelle</option>
            <option value="paypal">PayPal</option>
            <option value="venmo">Venmo</option>
            <option value="cashapp">CashApp</option>
            <option value="other">Other</option>
        </select>

        <input type="text" name="contactInfo" placeholder="Contact Info (Email, Phone)" required>
        <button type="submit">Submit</button>
    </form>

    <h2>Current Offers</h2>
    {% if current_offer %}
        <p>current_offer: {{ current_offer }}</p>
    {% else %}
        <p>No Offer Made</p>
    {% endif %}
    <button id="cancel-offer">Cancel Offer</button>

   {% if pending_transaction is not none %}
     <div id="accept-notif">
       <span> {{ pending_transaction.name }} ({{ pending_transaction.id }}) has accepted your offer.</span>
        <button id="accept-notif-proceed">Press to Proceed</button>
     </div>
    {% endif %}

    <script>
      document.getElementById("cancel-offer").addEventListener("click", function() {
          fetch('/cancel-offer', {
              method: 'POST'
          })
          .then(response => {
          if (response.redirected) {
              window.location.href = response.url;  // Follow the redirect in JavaScript
          }
        })
        .catch(error => console.error('Error:', error));
      });

      document.getElementById("accept-notif-proceed").addEventListener("click", function() {
          fetch('/accept-notif-proceed', {
              method: 'POST'
          })
          .then(response => {
          if (response.redirected) {
              window.location.href = response.url;  // Follow the redirect in JavaScript
          }
        })
        .catch(error => console.error('Error:', error));
      });
    </script>

    <h2>Current Prices</h2>
    <p>min seller price: ${{ min_seller.min_price }}</p>
    <p>max buyer price: ${{ max_buyer.max_price }}</p>

    <button id="buy_min">Buy Min</button>
    <button id="sell_max">Sell Max</button>

    <script>
      document.getElementById("buy_min").addEventListener("click", function() {
          fetch('/buy-min', {
              method: 'POST'
          })
          .then(response => {
          if (response.redirected) {
              window.location.href = response.url;  // Follow the redirect in JavaScript
          }
        })
        .catch(error => console.error('Error:', error));
      });

      document.getElementById("sell_max").addEventListener("click", function() {
          fetch('/sell-max', {
              method: 'POST'
          })
          .then(response => {
          if (response.redirected) {
              window.location.href = response.url;  // Follow the redirect in JavaScript
          }
        })
        .catch(error => console.error('Error:', error));
      });
    </script>

    <h2>Transaction History</h2>
    <ul>
      {% for entry in log %}
          <li>{{ entry }}</li>
      {% endfor %}
    </ul>

    <!--<script>-->
    <!--    const socket = io();-->
    <!---->
    <!--    socket.on('notifyTransactionPlaced', (data) => {-->
    <!--      const transaction = data;-->
    <!--      document.getElementById("lo")-->
    <!--    })-->
    <!---->
    <!--    // Listen for real-time notifications-->
    <!--    socket.on('notifySeller', (data) => {-->
    <!--        const { buyer, seller } = data;-->
    <!--        document.getElementById('notifications').innerText = `Seller ${seller.name}, you have a buyer (${buyer.name}) offering $${buyer.price}. You have 5 minutes to respond.`;-->
    <!--    });-->
    <!---->
    <!--    socket.on('notifyBuyer', (data) => {-->
    <!--        const { buyer, seller } = data;-->
    <!--        document.getElementById('notifications').innerText = `Buyer ${buyer.name}, seller (${seller.name}) is offering at $${seller.price}.`;-->
    <!--    });-->
    <!--</script>-->
</body>
</html>
